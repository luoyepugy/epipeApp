define(["./module"],function(e){e.directive("ionicCity",["$ionicModal","$timeout","$ionicScrollDelegate","cityService",function(e,t,c,i){return{restrict:"E",scope:{},replace:!0,template:'<input type="text" name="shipAddress" placeholder="{{placeholder}}" ng-model="$parent.shipAddress" value="{{$parent.shipAddress}}" readonly />',link:function(n,o,a){cityModel=null,n.user={},n.provinceHandle="provinceHandle",n.cityHandle="cityHandle",n.countryHandle="countryHandle",n.placeholder=a.placeholder||"地点",n.okText=a.oktext||"完成",n.barCssClass=a.barcssclass||"bar-dark",n.cityData=i.cityList,n.tag=a.tag||"-",n.returnOk=function(){cityModel&&cityModel.hide()},n.getData=function(e){var i,o,a;switch(t.cancel(n.scrolling),t.cancel(n.dataing),e){case"province":if(!n.cityData)return!1;var r=!0;i=n.cityData.length,o=n.provinceHandle,a=n.cityHandle;break;case"city":if(!n.province.sub)return!1;var l=!0;i=n.province.sub.length,o=n.cityHandle,a=n.countryHandle;break;case"country":if(!n.city.sub)return!1;var d=!0;i=n.city.sub.length,o=n.countryHandle}var s=c.$getByHandle(o).getScrollPosition().top,y=Math.round(s/36);0>y&&(y=0),y>i-1&&(y=i-1),s===36*y?n.dataing=t(function(){r&&(n.province=n.cityData[y],n.city=n.province.sub[0],n.country={},n.city&&n.city.sub&&(n.country=n.city.sub[0])),l&&(n.city=n.province.sub[y],n.country={},n.city&&n.city.sub&&(n.country=n.city.sub[0])),d&&(n.country=n.city.sub[y]),n.city.sub&&n.city.sub.length>0?n.$parent.shipAddress=n.province.name+n.tag+n.city.name+n.tag+n.country.name:n.$parent.shipAddress=n.province.name+n.tag+n.city.name},150):n.scrolling=t(function(){c.$getByHandle(o).scrollTo(0,36*y,!0)},150)},o.on("click",function(){return a.checked?void(cityModel&&cityModel.show()):(cityModel&&cityModel.remove(),a.checked=!0,void e.fromTemplateUrl("./js/templates/cityTemp.html",{scope:n,animation:"slide-in-up",backdropClickToClose:!0}).then(function(e){cityModel=e,t(function(){n.getData("province"),cityModel&&cityModel.show()},100)}))}),n.$on("$destroy",function(){cityModel&&cityModel.remove()})}}}])});